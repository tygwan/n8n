{
  "name": "US_Stock_Data_Collector",
  "nodes": [
    {
      "id": "trigger",
      "name": "Workflow Trigger",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [0, 300],
      "parameters": {
        "inputSource": "passthrough"
      }
    },
    {
      "id": "set_ticker",
      "name": "Set Ticker",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [220, 300],
      "parameters": {
        "mode": "manual",
        "assignments": {
          "assignments": [
            {
              "id": "ticker",
              "name": "ticker",
              "value": "={{ $json.ticker }}",
              "type": "string"
            },
            {
              "id": "api_key",
              "name": "api_key",
              "value": "YOUR_ALPHA_VANTAGE_API_KEY",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true
      }
    },
    {
      "id": "get_quote",
      "name": "Get Quote",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [460, 100],
      "parameters": {
        "method": "GET",
        "url": "=https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol={{ $json.ticker }}&apikey={{ $json.api_key }}"
      }
    },
    {
      "id": "get_rsi",
      "name": "Get RSI",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [460, 250],
      "parameters": {
        "method": "GET",
        "url": "=https://www.alphavantage.co/query?function=RSI&symbol={{ $('Set Ticker').item.json.ticker }}&interval=daily&time_period=14&series_type=close&apikey={{ $('Set Ticker').item.json.api_key }}"
      }
    },
    {
      "id": "get_macd",
      "name": "Get MACD",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [460, 400],
      "parameters": {
        "method": "GET",
        "url": "=https://www.alphavantage.co/query?function=MACD&symbol={{ $('Set Ticker').item.json.ticker }}&interval=daily&series_type=close&apikey={{ $('Set Ticker').item.json.api_key }}"
      }
    },
    {
      "id": "get_bbands",
      "name": "Get Bollinger Bands",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [460, 550],
      "parameters": {
        "method": "GET",
        "url": "=https://www.alphavantage.co/query?function=BBANDS&symbol={{ $('Set Ticker').item.json.ticker }}&interval=daily&time_period=20&series_type=close&apikey={{ $('Set Ticker').item.json.api_key }}"
      }
    },
    {
      "id": "get_overview",
      "name": "Get Fundamentals",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [460, 700],
      "parameters": {
        "method": "GET",
        "url": "=https://www.alphavantage.co/query?function=OVERVIEW&symbol={{ $('Set Ticker').item.json.ticker }}&apikey={{ $('Set Ticker').item.json.api_key }}"
      }
    },
    {
      "id": "get_news",
      "name": "Get News Sentiment",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [460, 850],
      "parameters": {
        "method": "GET",
        "url": "=https://www.alphavantage.co/query?function=NEWS_SENTIMENT&tickers={{ $('Set Ticker').item.json.ticker }}&limit=10&apikey={{ $('Set Ticker').item.json.api_key }}"
      }
    },
    {
      "id": "wait_parallel",
      "name": "Wait for All",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [720, 400],
      "parameters": {
        "mode": "combine",
        "combinationMode": "multiplex",
        "options": {}
      }
    },
    {
      "id": "normalize_data",
      "name": "Normalize Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [960, 400],
      "parameters": {
        "language": "javaScript",
        "mode": "runOnceForAllItems",
        "jsCode": "// ìž…ë ¥ ë°ì´í„° ìˆ˜ì§‘\nconst allItems = $input.all();\nconst ticker = $('Set Ticker').first().json.ticker;\n\n// ê° API ì‘ë‹µì—ì„œ ë°ì´í„° ì¶”ì¶œ\nlet quoteData = {};\nlet rsiData = {};\nlet macdData = {};\nlet bbandsData = {};\nlet overviewData = {};\nlet newsData = {};\n\n// ëª¨ë“  ì•„ì´í…œì—ì„œ ë°ì´í„° ì°¾ê¸°\nfor (const item of allItems) {\n  const json = item.json;\n  if (json['Global Quote']) quoteData = json['Global Quote'];\n  if (json['Technical Analysis: RSI']) rsiData = json['Technical Analysis: RSI'];\n  if (json['Technical Analysis: MACD']) macdData = json['Technical Analysis: MACD'];\n  if (json['Technical Analysis: BBANDS']) bbandsData = json['Technical Analysis: BBANDS'];\n  if (json['Symbol'] && json['PERatio']) overviewData = json;\n  if (json['feed']) newsData = json;\n}\n\n// ìµœì‹  RSI ê°’ ì¶”ì¶œ\nconst rsiDates = Object.keys(rsiData);\nconst latestRsi = rsiDates.length > 0 ? parseFloat(rsiData[rsiDates[0]]?.RSI) : null;\n\n// ìµœì‹  MACD ê°’ ì¶”ì¶œ\nconst macdDates = Object.keys(macdData);\nconst latestMacd = macdDates.length > 0 ? {\n  value: parseFloat(macdData[macdDates[0]]?.MACD || 0),\n  signal: parseFloat(macdData[macdDates[0]]?.MACD_Signal || 0),\n  histogram: parseFloat(macdData[macdDates[0]]?.MACD_Hist || 0)\n} : { value: 0, signal: 0, histogram: 0 };\n\n// ìµœì‹  Bollinger Bands ê°’ ì¶”ì¶œ\nconst bbandsDates = Object.keys(bbandsData);\nconst latestBbands = bbandsDates.length > 0 ? {\n  upper: parseFloat(bbandsData[bbandsDates[0]]?.['Real Upper Band'] || 0),\n  middle: parseFloat(bbandsData[bbandsDates[0]]?.['Real Middle Band'] || 0),\n  lower: parseFloat(bbandsData[bbandsDates[0]]?.['Real Lower Band'] || 0)\n} : null;\n\n// ë‰´ìŠ¤ ê°ì„± ì ìˆ˜ ê³„ì‚°\nconst feeds = newsData.feed || [];\nlet sentimentSum = 0;\nlet sentimentCount = 0;\nconst headlines = [];\n\nfeeds.slice(0, 5).forEach(item => {\n  if (item.overall_sentiment_score) {\n    sentimentSum += parseFloat(item.overall_sentiment_score);\n    sentimentCount++;\n  }\n  if (item.title) {\n    headlines.push(item.title);\n  }\n});\n\nconst avgSentiment = sentimentCount > 0 ? sentimentSum / sentimentCount : 0;\n\n// ì¶”ì„¸ íŒë‹¨\nlet trend = 'neutral';\nif (latestRsi !== null) {\n  if (latestRsi > 60 && latestMacd.histogram > 0) trend = 'bullish';\n  else if (latestRsi < 40 && latestMacd.histogram < 0) trend = 'bearish';\n}\n\n// í˜„ìž¬ê°€\nconst currentPrice = parseFloat(quoteData['05. price']) || 0;\n\n// Bollinger Band ìœ„ì¹˜ ê³„ì‚° (0-100%)\nlet bbPosition = null;\nif (latestBbands && currentPrice > 0) {\n  const range = latestBbands.upper - latestBbands.lower;\n  if (range > 0) {\n    bbPosition = ((currentPrice - latestBbands.lower) / range * 100).toFixed(1);\n  }\n}\n\n// 52ì£¼ ê³ ì  ëŒ€ë¹„ ìœ„ì¹˜\nconst week52High = parseFloat(overviewData['52WeekHigh']) || 0;\nconst week52Low = parseFloat(overviewData['52WeekLow']) || 0;\nlet pricePosition52w = null;\nif (week52High > week52Low) {\n  pricePosition52w = ((currentPrice - week52Low) / (week52High - week52Low) * 100).toFixed(1);\n}\n\n// í†µí•© ìŠ¤í‚¤ë§ˆë¡œ ì •ê·œí™”\nconst normalizedData = {\n  ticker: ticker,\n  name: overviewData.Name || ticker,\n  market: 'US',\n  currency: 'USD',\n  \n  // ê°€ê²© ì •ë³´\n  price: currentPrice,\n  change_pct: parseFloat(quoteData['10. change percent']?.replace('%', '')) || 0,\n  volume: parseInt(quoteData['06. volume']) || 0,\n  high: parseFloat(quoteData['03. high']) || 0,\n  low: parseFloat(quoteData['04. low']) || 0,\n  \n  // ê¸°ìˆ ì  ì§€í‘œ\n  technical: {\n    rsi: latestRsi,\n    rsi_signal: latestRsi > 70 ? 'overbought' : latestRsi < 30 ? 'oversold' : 'neutral',\n    macd: latestMacd,\n    macd_signal: latestMacd.histogram > 0 ? 'bullish' : 'bearish',\n    bollinger: latestBbands,\n    bb_position: bbPosition,\n    trend: trend,\n    price_position_52w: pricePosition52w\n  },\n  \n  // íŽ€ë”ë©˜í„¸\n  fundamental: {\n    per: parseFloat(overviewData.PERatio) || null,\n    pbr: parseFloat(overviewData.PriceToBookRatio) || null,\n    roe: parseFloat(overviewData.ReturnOnEquityTTM) || null,\n    market_cap: parseInt(overviewData.MarketCapitalization) || 0,\n    dividend_yield: overviewData.DividendYield ? parseFloat(overviewData.DividendYield) * 100 : null,\n    eps: parseFloat(overviewData.EPS) || null,\n    sector: overviewData.Sector || '',\n    industry: overviewData.Industry || '',\n    beta: parseFloat(overviewData.Beta) || null,\n    week52_high: week52High,\n    week52_low: week52Low\n  },\n  \n  // ë‰´ìŠ¤/ê°ì„±\n  sentiment: {\n    score: parseFloat(avgSentiment.toFixed(3)),\n    label: avgSentiment > 0.15 ? 'positive' : avgSentiment < -0.15 ? 'negative' : 'neutral',\n    news_count: feeds.length,\n    top_headlines: headlines\n  },\n  \n  // ë©”íƒ€ë°ì´í„°\n  collected_at: new Date().toISOString(),\n  data_source: 'Alpha Vantage'\n};\n\nreturn [{ json: normalizedData }];"
      }
    },
    {
      "id": "sticky_note_1",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [-80, 60],
      "parameters": {
        "content": "## ðŸ‡ºðŸ‡¸ US Stock Data Collector\n\n### ìž…ë ¥\n```json\n{ \"ticker\": \"AAPL\" }\n```\n\n### ìˆ˜ì§‘ ë°ì´í„°\n- ðŸ“ˆ í˜„ìž¬ê°€ (Global Quote)\n- ðŸ“Š RSI (14ì¼)\n- ðŸ“‰ MACD\n- ðŸ“ Bollinger Bands\n- ðŸ’° íŽ€ë”ë©˜í„¸ (PER, PBR, ROE ë“±)\n- ðŸ“° ë‰´ìŠ¤ ê°ì„±\n\n### ì¶œë ¥\ní†µí•© ìŠ¤í‚¤ë§ˆ JSON (í•œêµ­ ì£¼ì‹ê³¼ ë™ì¼ í˜•ì‹)",
        "width": 300,
        "height": 300
      }
    },
    {
      "id": "sticky_note_2",
      "name": "API Setup",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [200, 60],
      "parameters": {
        "content": "## âš ï¸ API Key ì„¤ì •\n\n`Set Ticker` ë…¸ë“œì—ì„œ\n`YOUR_ALPHA_VANTAGE_API_KEY`ë¥¼\nì‹¤ì œ API í‚¤ë¡œ ë³€ê²½í•˜ì„¸ìš”.\n\n### ë°œê¸‰ ë§í¬\nhttps://www.alphavantage.co/support/#api-key\n\n### ë¬´ë£Œ í•œë„\n25 calls/day\n\n### í”„ë¦¬ë¯¸ì—„ ê¶Œìž¥\nì¤‘ê¸° ë¶„ì„ ì‹œ í˜¸ì¶œ ìˆ˜ ì¦ê°€",
        "width": 240,
        "height": 260
      }
    }
  ],
  "connections": {
    "Workflow Trigger": {
      "main": [[{"node": "Set Ticker", "type": "main", "index": 0}]]
    },
    "Set Ticker": {
      "main": [[
        {"node": "Get Quote", "type": "main", "index": 0},
        {"node": "Get RSI", "type": "main", "index": 0},
        {"node": "Get MACD", "type": "main", "index": 0},
        {"node": "Get Bollinger Bands", "type": "main", "index": 0},
        {"node": "Get Fundamentals", "type": "main", "index": 0},
        {"node": "Get News Sentiment", "type": "main", "index": 0}
      ]]
    },
    "Get Quote": {"main": [[{"node": "Wait for All", "type": "main", "index": 0}]]},
    "Get RSI": {"main": [[{"node": "Wait for All", "type": "main", "index": 0}]]},
    "Get MACD": {"main": [[{"node": "Wait for All", "type": "main", "index": 0}]]},
    "Get Bollinger Bands": {"main": [[{"node": "Wait for All", "type": "main", "index": 0}]]},
    "Get Fundamentals": {"main": [[{"node": "Wait for All", "type": "main", "index": 0}]]},
    "Get News Sentiment": {"main": [[{"node": "Wait for All", "type": "main", "index": 0}]]},
    "Wait for All": {"main": [[{"node": "Normalize Data", "type": "main", "index": 0}]]}
  },
  "settings": {"executionOrder": "v1"},
  "tags": [{"name": "stock-analysis"}, {"name": "us-market"}]
}
